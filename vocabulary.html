<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vocabulary Learning System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        color: #2d4059;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header .current-date {
        color: #666;
        font-size: 1.1em;
      }

      .chart-container {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        height: 400px;
      }

      .statistics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
      }

      .input-section {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .search-bar {
        margin-bottom: 15px;
      }

      .search-bar input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
      }

      .input-group {
        display: grid;
        grid-template-columns: 1fr 1fr auto auto auto;
        gap: 10px;
        align-items: center;
      }

      input {
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s;
      }

      input:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
      }

      button {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      button:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .export-btn {
        background: #27ae60;
      }

      .import-btn {
        background: #8e44ad;
      }

      .boxes-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }

      .box {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .box:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .box-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .box-header h3 {
        color: #2d4059;
        font-size: 1.5em;
        margin-bottom: 5px;
      }

      .word-count {
        background: #3498db;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 1.2em;
        font-weight: bold;
      }

      .word-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .word-item {
        background: #f8f9fa;
        padding: 12px;
        margin: 8px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s;
      }

      .word-item:hover {
        transform: translateX(5px);
        background: #f0f0f0;
      }

      .word-content {
        flex: 1;
      }

      .word-text {
        font-weight: 500;
      }

      .word-translation {
        font-size: 0.9em;
        color: #666;
        margin-top: 4px;
      }

      .word-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        padding: 0;
      }

      .audio-btn {
        background: #3498db;
        color: white;
      }

      .delete-btn {
        background: #e74c3c;
        color: white;
      }

      .flashcard-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .flashcard-container {
        width: 500px;
        perspective: 1000px;
      }

      .flashcard {
        position: relative;
        width: 100%;
        height: 300px;
        transform-style: preserve-3d;
        transition: transform 0.6s;
        cursor: pointer;
      }

      .flashcard.flipped {
        transform: rotateY(180deg);
      }

      .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .card-back {
        transform: rotateY(180deg);
      }

      .card-content {
        text-align: center;
      }

      .card-word {
        font-size: 24px;
        margin-bottom: 15px;
      }

      .card-controls {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 8px;
        color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: none;
        z-index: 1001;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .settings-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #3498db;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 999;
      }

      .settings-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .settings-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
      }

      .settings-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .settings-close {
        cursor: pointer;
        font-size: 24px;
      }

      .settings-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #3498db;
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      /* Dark mode styles */
      /* Thay đổi phần dark mode styles trong CSS */
      body.dark-mode {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      }

      .dark-mode .box,
      .dark-mode .input-section,
      .dark-mode .stat-card,
      .dark-mode .chart-container,
      .dark-mode .settings-content,
      .dark-mode .card-face {
        background: #1a1a2e;
        color: #e1e1e1;
        border: 1px solid #30475e;
      }

      .dark-mode .word-item {
        background: #16213e;
        color: #e1e1e1;
        border: 1px solid #30475e;
      }

      .dark-mode input {
        background: #16213e;
        color: #e1e1e1;
        border: 2px solid #30475e;
      }

      .dark-mode input:focus {
        border-color: #4ecca3;
        box-shadow: 0 0 5px rgba(78, 204, 163, 0.3);
      }

      .dark-mode .header h1 {
        color: #e1e1e1;
      }

      .dark-mode .word-translation {
        color: #a5a5a5;
      }

      .dark-mode .box-header h3 {
        color: #4ecca3;
      }

      .dark-mode .stat-value {
        color: #4ecca3;
      }

      .dark-mode .stat-label {
        color: #a5a5a5;
      }

      .dark-mode .current-date {
        color: #a5a5a5;
      }
      .word-inputs {
        display: flex;
        gap: 10px;
        flex: 2;
      }

      .image-upload {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        flex: 1;
      }

      .image-preview {
        width: 100px;
        height: 100px;
        border: 2px dashed #e0e0e0;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .image-preview img {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
      }

      .image-preview .remove-image {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(231, 76, 60, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
      }

      .image-btn {
        background: #9b59b6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .image-btn:hover {
        background: #8e44ad;
      }

      /* Sửa lại style cho flashcard để hiển thị ảnh */
      .card-image {
        width: 200px;
        height: 200px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 15px;
      }

      .card-image img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 8px;
      }

      .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .card-face.front {
        transform: rotateY(0deg);
      }

      .card-face.back {
        transform: rotateY(180deg);
      }

      .flashcard {
        position: relative;
        width: 100%;
        height: 400px; /* Tăng chiều cao để chứa ảnh */
        transform-style: preserve-3d;
        transition: transform 0.6s;
        cursor: pointer;
      }

      .flashcard.flipped {
        transform: rotateY(180deg);
      }

      .card-content {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .card-word {
        font-size: 28px;
        margin: 10px 0;
      }

      .card-meaning {
        font-size: 24px;
      }
      /* Thông báo xoay màn hình */
      .study-options-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .study-options-container {
        background: white;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 800px;
      }

      .study-options-container h2 {
        text-align: center;
        color: #2d4059;
        margin-bottom: 30px;
      }

      .study-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .study-option-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        background: white;
        transition: all 0.3s;
      }

      .study-option-btn:hover {
        transform: translateY(-5px);
        border-color: #3498db;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
      }

      .study-option-btn i {
        font-size: 2em;
        margin-bottom: 10px;
        color: #3498db;
      }

      .study-option-btn span {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 5px;
        color: #2d4059;
      }

      .study-option-btn p {
        font-size: 0.9em;
        color: #666;
        text-align: center;
        margin: 0;
      }

      .close-modal-btn {
        display: block;
        margin: 0 auto;
        padding: 12px 30px;
        background: #e74c3c;
      }

      .close-modal-btn:hover {
        background: #c0392b;
      }

      /* Dark mode styles for study options modal */
      .dark-mode .study-options-container {
        background: #1a1a2e;
      }

      .dark-mode .study-options-container h2 {
        color: #e1e1e1;
      }

      .dark-mode .study-option-btn {
        background: #16213e;
        border-color: #30475e;
      }

      .dark-mode .study-option-btn:hover {
        border-color: #4ecca3;
        box-shadow: 0 5px 15px rgba(78, 204, 163, 0.2);
      }

      .dark-mode .study-option-btn span {
        color: #e1e1e1;
      }

      .dark-mode .study-option-btn p {
        color: #a5a5a5;
      }
      .back-button {
        position: absolute;
        left: 20px;
        top: 20px;
        padding: 10px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
        z-index: 100;
      }

      .back-button:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .header {
        position: relative;
        padding-top: 20px;
      }

      /* Dark mode styles */
      .dark-mode .back-button {
        background: #2c3e50;
        color: #fff;
      }

      .dark-mode .back-button:hover {
        background: #34495e;
      }
      /* Mobile Responsive Styles */
      @media screen and (max-width: 768px) {
        /* Container adjustments */
        .container {
          padding: 10px;
        }

        /* Header adjustments */
        .header h1 {
          font-size: 1.8em;
        }

        .back-button {
          left: 10px;
          top: 10px;
          padding: 8px 15px;
          font-size: 14px;
        }

        /* Statistics cards */
        .statistics {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .stat-card {
          padding: 15px;
        }

        .stat-value {
          font-size: 20px;
        }

        .stat-label {
          font-size: 14px;
        }

        /* Input section */
        .input-section {
          padding: 15px;
        }

        .input-group {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .word-inputs {
          flex-direction: column;
          gap: 15px;
        }

        input {
          padding: 10px;
          font-size: 14px;
        }

        /* Image upload section */
        .image-upload {
          width: 100%;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
        }

        .image-preview {
          width: 80px;
          height: 80px;
        }

        /* Boxes container */
        .boxes-container {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .box {
          padding: 15px;
          min-height: 100px;
        }

        /* Flashcard adjustments */
        .flashcard-container {
          width: 90%;
          max-width: 350px;
        }

        .flashcard {
          height: 300px;
        }

        .card-face {
          padding: 15px;
        }

        .card-word {
          font-size: 24px;
        }

        .card-meaning {
          font-size: 20px;
        }

        .card-image {
          width: 150px;
          height: 150px;
        }

        /* Study options modal */
        .study-options-container {
          padding: 20px;
        }

        .study-options {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .study-option-btn {
          padding: 15px;
        }

        /* Settings modal */
        .settings-content {
          width: 95%;
          padding: 20px;
        }

        .settings-option {
          padding: 12px 0;
        }

        /* Button adjustments */
        button {
          padding: 10px 20px;
          font-size: 14px;
        }

        .action-btn {
          width: 28px;
          height: 28px;
        }

        /* Word items */
        .word-item {
          padding: 10px;
          flex-direction: column;
          gap: 10px;
        }

        .word-actions {
          width: 100%;
          justify-content: center;
        }

        /* Notification */
        .notification {
          top: 10px;
          right: 10px;
          padding: 12px 20px;
          font-size: 14px;
        }

        /* Settings button */
        .settings-btn {
          bottom: 15px;
          right: 15px;
          width: 45px;
          height: 45px;
        }
      }

      /* Additional improvements for very small screens */
      @media screen and (max-width: 380px) {
        .header h1 {
          font-size: 1.5em;
        }

        .stat-card {
          padding: 12px;
        }

        .stat-value {
          font-size: 18px;
        }

        .card-word {
          font-size: 20px;
        }

        .card-meaning {
          font-size: 18px;
        }

        .card-image {
          width: 120px;
          height: 120px;
        }
      }

      /* Landscape mode warning */
      @media screen and (max-height: 500px) and (orientation: landscape) {
        .flashcard-modal::before {
          content: "Vui lòng xoay điện thoại để xem tốt hơn";
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 20px;
          border-radius: 10px;
          text-align: center;
          z-index: 1002;
        }
      }

      /* Touch device optimizations */
      @media (hover: none) {
        .box:hover,
        .word-item:hover,
        button:hover {
          transform: none;
        }

        .box:active,
        .word-item:active,
        button:active {
          transform: scale(0.98);
        }

        .study-option-btn:active {
          transform: scale(0.98);
          border-color: #3498db;
        }
      }

      /* Better tap targets for mobile */
      @media (max-width: 768px) {
        .action-btn,
        .settings-btn,
        .close-modal-btn {
          min-width: 44px;
          min-height: 44px;
        }

        .word-actions {
          gap: 15px;
        }

        /* Improve scrolling */
        .word-list {
          -webkit-overflow-scrolling: touch;
          scroll-behavior: smooth;
        }

        /* Add pull-to-refresh visual indicator */
        .word-list::before {
          content: "⟳ Kéo xuống để làm mới";
          display: block;
          text-align: center;
          padding: 10px;
          color: #666;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Vocabulary Learning System</h1>
        <div class="current-date" id="currentDate"></div>
      </div>

      <div class="statistics">
        <div class="stat-card">
          <div class="stat-value" id="totalWords">0</div>
          <div class="stat-label">Total Words</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="masteredWords">0</div>
          <div class="stat-label">Mastered Words</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="learningStreak">0</div>
          <div class="stat-label">Day Streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="reviewAccuracy">0%</div>
          <div class="stat-label">Review Accuracy</div>
        </div>
      </div>

      <div class="chart-container">
        <canvas id="retentionChart"></canvas>
      </div>

      <div class="input-section">
        <div class="search-bar">
          <input
            type="text"
            id="searchWords"
            placeholder="Search words..."
            oninput="vocabularyManager.filterWords(this.value)"
          />
        </div>
        <div class="input-group">
          <div class="word-inputs">
            <input
              type="text"
              id="englishWord"
              placeholder="Enter English word"
            />
            <input
              type="text"
              id="vietnameseMeaning"
              placeholder="Enter Vietnamese meaning"
            />
          </div>
          <div class="image-upload">
            <label for="wordImage" class="image-upload-label">
              <i class="fas fa-image"></i>
              <span>Add Image</span>
              <input
                type="file"
                id="wordImage"
                accept="image/*"
                capture="environment"
                style="display: none"
              />
            </label>
            <div id="imagePreview" class="image-preview"></div>
          </div>
          <div class="action-buttons">
            <button onclick="vocabularyManager.addWord()">
              <i class="fas fa-plus"></i> Add Word
            </button>
          </div>
        </div>
      </div>

      <div class="boxes-container">
        <div class="box" onclick="vocabularyManager.showStudyOptions(100)">
          <div class="box-header">
            <h3>Mastered</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(75)">
          <div class="box-header">
            <h3>Learning</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(50)">
          <div class="box-header">
            <h3>Practicing</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(25)">
          <div class="box-header">
            <h3>Beginning</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(0)">
          <div class="box-header">
            <h3>New</h3>
            <span class="word-count">0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Flashcard Modal -->
    <div class="flashcard-modal" id="flashcardModal">
      <div class="flashcard-container">
        <div class="flashcard">
          <!-- Mặt trước của flashcard -->
          <div class="card-face front">
            <div class="card-content">
              <div class="card-image"></div>
              <div class="card-word"></div>
              <button
                class="audio-btn action-btn"
                onclick="event.stopPropagation(); vocabularyManager.playAudio(document.querySelector('.card-word').textContent)"
              >
                <i class="fas fa-volume-up"></i>
              </button>
            </div>
          </div>

          <!-- Mặt sau của flashcard -->
          <div class="card-face back">
            <div class="card-content">
              <div class="card-meaning"></div>
            </div>
          </div>
        </div>

        <!-- Các nút điều khiển -->
        <div class="card-controls">
          <button onclick="vocabularyManager.previousCard()">
            <i class="fas fa-chevron-left"></i> Previous
          </button>
          <button onclick="vocabularyManager.closeFlashcards()">
            <i class="fas fa-times"></i> Close
          </button>
          <button onclick="vocabularyManager.nextCard()">
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="settings-modal" id="settingsModal">
      <div class="settings-content">
        <div class="settings-header">
          <h2>Settings</h2>
          <span
            class="settings-close"
            onclick="vocabularyManager.closeSettings()"
            >&times;</span
          >
        </div>
        <div class="settings-option">
          <span>Dark Mode</span>
          <label class="switch">
            <input
              type="checkbox"
              id="darkModeToggle"
              onchange="vocabularyManager.toggleDarkMode()"
            />
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span>Auto-play Pronunciation</span>
          <label class="switch">
            <input type="checkbox" id="autoPlayToggle" />
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span>Reset Progress</span>
          <button
            onclick="vocabularyManager.resetProgress()"
            style="background-color: #e74c3c"
          >
            Reset
          </button>
        </div>
      </div>
    </div>

    <button class="settings-btn" onclick="vocabularyManager.openSettings()">
      <i class="fas fa-cog"></i>
    </button>

    <div class="notification" id="notification"></div>
    <script>
      class VocabularyManager {
        constructor() {
          // Lấy thông tin thư mục hiện tại
          this.currentFolderId = localStorage.getItem("current_folder_id");
          this.currentFolderName = localStorage.getItem("current_folder_name");

          // Nếu không có folder ID, quay về trang index
          if (!this.currentFolderId) {
            window.location.href = "index.html";
            return;
          }

          this.vocabulary = [];
          this.currentCardIndex = 0;
          this.currentLevel = null;
          this.settings = this.loadSettings();
          this.streak = this.loadStreak();
          this.lastStudyDate = localStorage.getItem("lastStudyDate");
          this.currentImage = null;

          // Initialize
          this.loadVocabulary();
          this.initChart();
          this.setupEventListeners();
          this.updateDisplay();
          this.updateCurrentDate();
          this.checkAndUpdateLevels();

          // Check streak and levels every minute
          setInterval(() => {
            this.checkAndUpdateLevels();
            this.updateCurrentDate();
          }, 60000);

          // Check when tab becomes visible
          document.addEventListener("visibilitychange", () => {
            if (document.visibilityState === "visible") {
              this.checkAndUpdateLevels();
              this.updateCurrentDate();
            }
          });
        }

        loadSettings() {
          return (
            JSON.parse(localStorage.getItem("settings")) || {
              darkMode: false,
              autoPlay: false,
              notificationInterval: 30,
            }
          );
        }

        saveSettings() {
          localStorage.setItem("settings", JSON.stringify(this.settings));
        }

        loadStreak() {
          return parseInt(localStorage.getItem("streak")) || 0;
        }

        updateCurrentDate() {
          const now = new Date();
          const options = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          };
          document.getElementById("currentDate").textContent =
            now.toLocaleDateString("en-US", options);
        }

        initChart() {
          const ctx = document
            .getElementById("retentionChart")
            .getContext("2d");
          this.chart = new Chart(ctx, {
            type: "line",
            data: {
              labels: [
                "Day 1",
                "Day 2",
                "Day 3",
                "Day 4",
                "Day 5",
                "Day 6",
                "Day 7",
              ],
              datasets: [
                {
                  label: "Memory Retention",
                  data: [100, 75, 50, 25, 10, 5, 0],
                  borderColor: "#3498db",
                  backgroundColor: "rgba(52, 152, 219, 0.1)",
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 100,
                },
              },
            },
          });
        }

        loadVocabulary() {
          try {
            // Lấy danh sách thư mục
            const folders = JSON.parse(
              localStorage.getItem("vocabulary_folders") || "[]"
            );
            // Tìm thư mục hiện tại
            const currentFolder = folders.find(
              (f) => f.id === this.currentFolderId
            );
            // Lấy từ vựng từ thư mục
            this.vocabulary = currentFolder
              ? currentFolder.vocabulary || []
              : [];
          } catch (error) {
            console.error("Error loading vocabulary:", error);
            this.vocabulary = [];
          }
        }

        saveVocabulary() {
          try {
            // Lấy danh sách thư mục
            const folders = JSON.parse(
              localStorage.getItem("vocabulary_folders") || "[]"
            );
            // Tìm vị trí thư mục hiện tại
            const folderIndex = folders.findIndex(
              (f) => f.id === this.currentFolderId
            );

            if (folderIndex !== -1) {
              // Cập nhật từ vựng và thông tin thư mục
              folders[folderIndex].vocabulary = this.vocabulary;
              folders[folderIndex].wordCount = this.vocabulary.length;
              folders[folderIndex].lastModified = new Date().toISOString();

              // Lưu lại vào localStorage
              localStorage.setItem(
                "vocabulary_folders",
                JSON.stringify(folders)
              );
              this.updateDisplay();
              this.updateStatistics();
            }
          } catch (error) {
            console.error("Error saving vocabulary:", error);
            this.showNotification("Couldn't save vocabulary", "error");
          }
        }

        checkAndUpdateLevels() {
          const now = Date.now();
          let hasChanges = false;

          this.vocabulary = this.vocabulary.map((word) => {
            if (!word.startTime) return word;

            const timeElapsed = now - word.startTime;
            let newLevel = word.level;

            if (timeElapsed >= 240000) {
              newLevel = 0;
            } else if (timeElapsed >= 180000) {
              newLevel = 25;
            } else if (timeElapsed >= 120000) {
              newLevel = 50;
            } else if (timeElapsed >= 60000) {
              newLevel = 75;
            }

            if (newLevel !== word.level) {
              hasChanges = true;
              return { ...word, level: newLevel, lastReviewed: now };
            }

            return word;
          });

          if (hasChanges) {
            this.saveVocabulary();
          }
        }

        updateStatistics() {
          const totalWords = this.vocabulary.length;
          const masteredWords = this.vocabulary.filter(
            (w) => w.level === 100
          ).length;
          const totalReviews = this.vocabulary.reduce(
            (sum, w) => sum + w.reviewCount,
            0
          );
          const totalMistakes = this.vocabulary.reduce(
            (sum, w) => sum + w.mistakes,
            0
          );

          const accuracy =
            totalReviews > 0
              ? Math.round(
                  ((totalReviews - totalMistakes) / totalReviews) * 100
                )
              : 0;

          document.getElementById("totalWords").textContent = totalWords;
          document.getElementById("masteredWords").textContent = masteredWords;
          document.getElementById("learningStreak").textContent = this.streak;
          document.getElementById(
            "reviewAccuracy"
          ).textContent = `${accuracy}%`;
        }

        handleImageUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          if (file.size > 5 * 1024 * 1024) {
            this.showNotification("File size should be less than 5MB", "error");
            return;
          }

          if (!file.type.startsWith("image/")) {
            this.showNotification("Please select an image file", "error");
            return;
          }

          const reader = new FileReader();

          reader.onload = (e) => {
            try {
              const img = new Image();

              img.onload = () => {
                const maxWidth = 800;
                const maxHeight = 800;

                let width = img.width;
                let height = img.height;

                if (width > maxWidth || height > maxHeight) {
                  if (width > height) {
                    height *= maxWidth / width;
                    width = maxWidth;
                  } else {
                    width *= maxHeight / height;
                    height = maxHeight;
                  }
                }

                const canvas = document.createElement("canvas");
                canvas.width = width;
                canvas.height = height;

                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, width, height);

                const resizedImage = canvas.toDataURL(file.type, 0.8);

                const imagePreview = document.getElementById("imagePreview");
                imagePreview.innerHTML = `<img src="${resizedImage}" alt="Preview">`;

                if (this.vocabulary.length > 0 && this.currentCardIndex >= 0) {
                  const words = this.vocabulary.filter(
                    (word) => word.level === this.currentLevel
                  );
                  if (words.length > 0) {
                    const currentWord = words[this.currentCardIndex];
                    const wordIndex = this.vocabulary.findIndex(
                      (w) => w.id === currentWord.id
                    );
                    if (wordIndex !== -1) {
                      this.vocabulary[wordIndex].image = resizedImage;
                      this.saveVocabulary();
                      this.updateFlashcard();
                      this.showNotification("Image added successfully!");
                    }
                  }
                } else {
                  this.currentImage = resizedImage;
                }
              };

              img.src = e.target.result;
            } catch (error) {
              console.error("Error processing image:", error);
              this.showNotification("Error processing image", "error");
            }
          };

          reader.onerror = (error) => {
            console.error("Error reading file:", error);
            this.showNotification("Error reading file", "error");
          };

          reader.readAsDataURL(file);
          event.target.value = "";
        }

        updateImagePreview() {
          const preview = document.getElementById("imagePreview");
          if (this.currentImage) {
            preview.innerHTML = `
                <img src="${this.currentImage}" alt="Word image">
                <button class="remove-image" onclick="vocabularyManager.removeImage()">
                  <i class="fas fa-times"></i>
                </button>
              `;
          } else {
            preview.innerHTML = "";
          }
        }

        removeImage() {
          this.currentImage = null;
          this.updateImagePreview();
          document.getElementById("wordImage").value = "";
        }
        addWord() {
          const englishInput = document.getElementById("englishWord");
          const vietnameseInput = document.getElementById("vietnameseMeaning");

          const english = this.sanitizeInput(englishInput.value);
          const vietnamese = this.sanitizeInput(vietnameseInput.value);

          if (!this.validateInputs(english, vietnamese)) return;

          const newWord = {
            id: this.generateUniqueId(),
            english,
            vietnamese,
            level: 100,
            startTime: Date.now(),
            lastReviewed: null,
            reviewCount: 0,
            mistakes: 0,
            image: this.currentImage,
          };

          this.vocabulary.push(newWord);
          this.saveVocabulary();
          this.clearInputs(englishInput, vietnameseInput);
          this.removeImage();
          this.showNotification(`Added: ${english}`);

          if (this.settings.autoPlay) {
            this.playAudio(english);
          }
        }

        createWordHTML(word) {
          return `
          <div class="word-item" data-id="${word.id}">
            <div class="word-content">
              ${
                word.image
                  ? `<div class="word-image"><img src="${word.image}" alt="${word.english}"></div>`
                  : ""
              }
              <div class="word-text">${word.english}</div>
              <div class="word-translation">${word.vietnamese}</div>
            </div>
            <div class="word-actions">
              <button class="audio-btn action-btn" onclick="event.stopPropagation(); vocabularyManager.playAudio('${
                word.english
              }')">
                <i class="fas fa-volume-up"></i>
              </button>
              <button class="delete-btn action-btn" onclick="event.stopPropagation(); vocabularyManager.deleteWord('${
                word.id
              }')">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        `;
        }

        deleteWord(id) {
          try {
            const wordIndex = this.vocabulary.findIndex((w) => w.id === id);
            if (wordIndex !== -1) {
              const deletedWord = this.vocabulary[wordIndex];
              this.vocabulary.splice(wordIndex, 1);
              this.saveVocabulary();
              this.showNotification(`Deleted: ${deletedWord.english}`);
            }
          } catch (error) {
            console.error("Error deleting word:", error);
            this.showNotification("Couldn't delete word", "error");
          }
        }

        updateDisplay() {
          const levels = [100, 75, 50, 25, 0];
          levels.forEach((level) => {
            const wordsAtLevel = this.vocabulary.filter(
              (word) => word.level === level
            );
            const box = document.querySelector(
              `[onclick="vocabularyManager.showStudyOptions(${level})"]`
            );
            if (box) {
              const countSpan = box.querySelector(".word-count");
              countSpan.textContent = wordsAtLevel.length;
            }
          });
        }

        showFlashcards(level) {
          const words = this.vocabulary.filter((word) => word.level === level);
          if (words.length === 0) {
            this.showNotification("No words at this level", "error");
            return;
          }

          this.currentLevel = level;
          this.currentCardIndex = 0;
          this.updateFlashcard();
          document.getElementById("flashcardModal").style.display = "flex";

          const flashcard = document.querySelector(".flashcard");
          if (flashcard) {
            const oldFlashcard = flashcard.cloneNode(true);
            flashcard.parentNode.replaceChild(oldFlashcard, flashcard);
            oldFlashcard.addEventListener("click", (e) => this.flipCard(e));
          }
        }

        updateFlashcard() {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          if (words.length > 0) {
            const currentWord = words[this.currentCardIndex];
            const cardWord = document.querySelector(".card-word");
            const cardMeaning = document.querySelector(".card-meaning");
            const cardImage = document.querySelector(
              ".card-face.front .card-image"
            );

            cardWord.textContent = currentWord.english;
            cardMeaning.textContent = currentWord.vietnamese;

            if (currentWord.image) {
              cardImage.innerHTML = `<img src="${currentWord.image}" alt="${currentWord.english}" style="max-width: 200px; max-height: 200px; border-radius: 8px;">`;
            } else {
              cardImage.innerHTML = "";
            }

            const flashcard = document.querySelector(".flashcard");
            flashcard.classList.remove("flipped");
          }
        }

        flipCard(event) {
          if (
            event &&
            (event.target.closest(".audio-btn") ||
              event.target.closest(".action-btn"))
          ) {
            return;
          }
          const flashcard = document.querySelector(".flashcard");
          flashcard.classList.toggle("flipped");
        }

        nextCard() {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          this.currentCardIndex = (this.currentCardIndex + 1) % words.length;
          this.updateFlashcard();
        }

        previousCard() {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          this.currentCardIndex =
            (this.currentCardIndex - 1 + words.length) % words.length;
          this.updateFlashcard();
        }

        setupEventListeners() {
          // Thêm nút Back
          const headerDiv = document.querySelector(".header");
          if (headerDiv) {
            const backButton = document.createElement("button");
            backButton.className = "back-button";
            backButton.innerHTML =
              '<i class="fas fa-arrow-left"></i> Back to Folders';
            backButton.onclick = () => (window.location.href = "index.html");
            headerDiv.insertBefore(backButton, headerDiv.firstChild);
          }

          // Cập nhật tiêu đề
          const title = document.querySelector(".header h1");
          if (title && this.currentFolderName) {
            title.textContent = `Vocabulary - ${this.currentFolderName}`;
          }

          document
            .getElementById("englishWord")
            .addEventListener("keypress", (e) => {
              if (e.key === "Enter") {
                document.getElementById("vietnameseMeaning").focus();
              }
            });

          document
            .getElementById("vietnameseMeaning")
            .addEventListener("keypress", (e) => {
              if (e.key === "Enter") {
                this.addWord();
              }
            });

          document.addEventListener("keydown", (e) => {
            if (
              document.getElementById("flashcardModal").style.display === "flex"
            ) {
              switch (e.key) {
                case "ArrowRight":
                  this.nextCard();
                  break;
                case "ArrowLeft":
                  this.previousCard();
                  break;
                case " ":
                  this.flipCard();
                  e.preventDefault();
                  break;
                case "Escape":
                  this.closeFlashcards();
                  break;
              }
            }
          });

          const flashcard = document.querySelector(".flashcard");
          if (flashcard) {
            flashcard.addEventListener("click", (e) => this.flipCard(e));
          }

          const imageInput = document.getElementById("wordImage");
          if (imageInput) {
            imageInput.addEventListener("change", (e) =>
              this.handleImageUpload(e)
            );
          }

          this.setupTouchEvents();

          if (this.settings.darkMode) {
            document.body.classList.add("dark-mode");
          }
        }

        setupTouchEvents() {
          const flashcard = document.querySelector(".flashcard");
          if (flashcard) {
            let touchStartX = 0;
            let touchStartY = 0;

            flashcard.addEventListener(
              "touchstart",
              (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
              },
              { passive: true }
            );

            flashcard.addEventListener(
              "touchend",
              (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const deltaX = touchEndX - touchStartX;
                const deltaY = touchEndY - touchStartY;

                if (Math.abs(deltaX) > 50 && Math.abs(deltaY) < 30) {
                  if (deltaX > 0) {
                    this.previousCard();
                  } else {
                    this.nextCard();
                  }
                } else if (Math.abs(deltaY) > 50 && Math.abs(deltaX) < 30) {
                  this.flipCard();
                }
              },
              { passive: true }
            );
          }

          const settingsBtn = document.querySelector(".settings-btn");
          if (settingsBtn) {
            settingsBtn.addEventListener("touchstart", (e) => {
              e.preventDefault();
              this.openSettings();
            });
          }

          const closeBtn = document.querySelector(".settings-close");
          if (closeBtn) {
            closeBtn.addEventListener("touchstart", (e) => {
              e.preventDefault();
              this.closeSettings();
            });
          }
        }

        playAudio(word) {
          try {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = "en-US";
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
          } catch (error) {
            console.error("Error playing audio:", error);
            this.showNotification("Couldn't play audio", "error");
          }
        }

        filterWords(query) {
          const normalizedQuery = query.toLowerCase().trim();
          const filteredWords = this.vocabulary.filter(
            (word) =>
              word.english.toLowerCase().includes(normalizedQuery) ||
              word.vietnamese.toLowerCase().includes(normalizedQuery)
          );
          this.displayFilteredWords(filteredWords);
        }

        displayFilteredWords(words) {
          const levels = [100, 75, 50, 25, 0];
          levels.forEach((level) => {
            const wordsAtLevel = words.filter((word) => word.level === level);
            const box = document.getElementById(`box${level}`);
            if (box) {
              const countSpan = box.parentElement.querySelector(".word-count");
              countSpan.textContent = wordsAtLevel.length;
              box.innerHTML = wordsAtLevel
                .map(this.createWordHTML.bind(this))
                .join("");
            }
          });
        }

        exportVocabulary() {
          const data = JSON.stringify(this.vocabulary, null, 2);
          const blob = new Blob([data], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `vocabulary_${
            new Date().toISOString().split("T")[0]
          }.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }

        async importVocabulary() {
          const input = document.createElement("input");
          input.type = "file";
          input.accept = ".json";

          input.onchange = async (e) => {
            try {
              const file = e.target.files[0];
              const text = await file.text();
              const importedVocabulary = JSON.parse(text);

              if (Array.isArray(importedVocabulary)) {
                this.vocabulary = [...this.vocabulary, ...importedVocabulary];
                this.saveVocabulary();
                this.showNotification(
                  `Imported ${importedVocabulary.length} words`
                );
              }
            } catch (error) {
              console.error("Error importing vocabulary:", error);
              this.showNotification("Error importing vocabulary", "error");
            }
          };

          input.click();
        }

        openSettings() {
          document.getElementById("settingsModal").style.display = "flex";
          document.getElementById("darkModeToggle").checked =
            this.settings.darkMode;
          document.getElementById("autoPlayToggle").checked =
            this.settings.autoPlay;
        }

        closeSettings() {
          document.getElementById("settingsModal").style.display = "none";
        }

        toggleDarkMode() {
          this.settings.darkMode = !this.settings.darkMode;
          document.body.classList.toggle("dark-mode");
          this.saveSettings();
        }

        resetProgress() {
          if (
            confirm(
              "Are you sure you want to reset all progress? This cannot be undone."
            )
          ) {
            this.vocabulary = [];
            this.saveVocabulary();
            this.showNotification("Progress reset successfully");
          }
        }

        sanitizeInput(input) {
          return input.trim().replace(/[<>]/g, "").replace(/\s+/g, " ");
        }

        validateInputs(english, vietnamese) {
          if (!english || !vietnamese) {
            this.showNotification("Please fill in all fields", "error");
            return false;
          }

          if (
            this.vocabulary.some(
              (w) => w.english.toLowerCase() === english.toLowerCase()
            )
          ) {
            this.showNotification("This word already exists", "error");
            return false;
          }

          return true;
        }

        generateUniqueId() {
          return (
            Date.now().toString() + Math.random().toString(36).substr(2, 9)
          );
        }

        clearInputs(englishInput, vietnameseInput) {
          englishInput.value = "";
          vietnameseInput.value = "";
          englishInput.focus();
        }

        showNotification(message, type = "success") {
          const notification = document.getElementById("notification");
          notification.textContent = message;
          notification.style.background =
            type === "success" ? "#2ecc71" : "#e74c3c";
          notification.style.display = "block";

          setTimeout(() => {
            notification.style.display = "none";
          }, 3000);
        }

        closeFlashcards() {
          document.getElementById("flashcardModal").style.display = "none";
        }

        showStudyOptions(level) {
          this.currentLevel = level;
          document.getElementById("studyOptionsModal").style.display = "flex";
        }

        closeStudyOptions() {
          document.getElementById("studyOptionsModal").style.display = "none";
        }

        startFlashcards(mode) {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          if (words.length === 0) {
            this.showNotification("No words at this level", "error");
            return;
          }

          this.closeStudyOptions();

          switch (mode) {
            case "regular":
              this.showFlashcards(this.currentLevel);
              break;
            case "quiz":
              this.showNotification("Quiz mode coming soon!", "success");
              break;
            case "writing":
              this.showNotification("Writing practice coming soon!", "success");
              break;
            case "listening":
              this.showNotification(
                "Listening practice coming soon!",
                "success"
              );
              break;
          }
        }
      }

      // Initialize the vocabulary manager
      const vocabularyManager = new VocabularyManager();
    </script>

    <!-- Study Options Modal -->
    <div class="study-options-modal" id="studyOptionsModal">
      <div class="study-options-container">
        <h2>Choose Study Mode</h2>
        <div class="study-options">
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('regular')"
          >
            <i class="fas fa-copy"></i>
            <span>Classic Flashcards</span>
            <p>Review words with front and back sides</p>
          </button>
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('quiz')"
          >
            <i class="fas fa-question-circle"></i>
            <span>Quiz Mode</span>
            <p>Test your knowledge with multiple choice questions</p>
          </button>
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('writing')"
          >
            <i class="fas fa-pencil-alt"></i>
            <span>Writing Practice</span>
            <p>Practice writing the words you've learned</p>
          </button>
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('listening')"
          >
            <i class="fas fa-headphones"></i>
            <span>Listening Practice</span>
            <p>Improve your listening skills</p>
          </button>
        </div>
        <button
          class="close-modal-btn"
          onclick="vocabularyManager.closeStudyOptions()"
        >
          <i class="fas fa-times"></i> Close
        </button>
      </div>
    </div>
  </body>
</html>
