<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vocabulary Learning System</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
      }

      .header h1 {
        color: #2d4059;
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header .current-date {
        color: #666;
        font-size: 1.1em;
      }

      .chart-container {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        height: 400px;
      }

      .statistics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #3498db;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
      }

      .input-section {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .search-bar {
        margin-bottom: 15px;
      }

      .search-bar input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
      }

      .input-group {
        display: grid;
        grid-template-columns: 1fr 1fr auto auto auto;
        gap: 10px;
        align-items: center;
      }

      input {
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s;
      }

      input:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
      }

      button {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      button:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .export-btn {
        background: #27ae60;
      }

      .import-btn {
        background: #8e44ad;
      }

      .boxes-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }

      .box {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .box:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
      }

      .box-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .box-header h3 {
        color: #2d4059;
        font-size: 1.5em;
        margin-bottom: 5px;
      }

      .word-count {
        background: #3498db;
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 1.2em;
        font-weight: bold;
      }

      .word-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .word-item {
        background: #f8f9fa;
        padding: 12px;
        margin: 8px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s;
      }

      .word-item:hover {
        transform: translateX(5px);
        background: #f0f0f0;
      }

      .word-content {
        flex: 1;
      }

      .word-text {
        font-weight: 500;
      }

      .word-translation {
        font-size: 0.9em;
        color: #666;
        margin-top: 4px;
      }

      .word-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        padding: 0;
      }

      .audio-btn {
        background: #3498db;
        color: white;
      }

      .delete-btn {
        background: #e74c3c;
        color: white;
      }

      .flashcard-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .flashcard-container {
        width: 500px;
        perspective: 1000px;
      }

      .flashcard {
        position: relative;
        width: 100%;
        height: 300px;
        transform-style: preserve-3d;
        transition: transform 0.6s;
        cursor: pointer;
      }

      .flashcard.flipped {
        transform: rotateY(180deg);
      }

      .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .card-back {
        transform: rotateY(180deg);
      }

      .card-content {
        text-align: center;
      }

      .card-word {
        font-size: 24px;
        margin-bottom: 15px;
      }

      .card-controls {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 8px;
        color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: none;
        z-index: 1001;
        animation: slideIn 0.3s ease;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .settings-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #3498db;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 999;
      }

      .settings-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .settings-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 500px;
      }

      .settings-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .settings-close {
        cursor: pointer;
        font-size: 24px;
      }

      .settings-option {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid #eee;
      }

      .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .slider {
        background-color: #3498db;
      }

      input:checked + .slider:before {
        transform: translateX(26px);
      }

      /* Dark mode styles */
      /* Thay đổi phần dark mode styles trong CSS */
      body.dark-mode {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      }

      .dark-mode .box,
      .dark-mode .input-section,
      .dark-mode .stat-card,
      .dark-mode .chart-container,
      .dark-mode .settings-content,
      .dark-mode .card-face {
        background: #1a1a2e;
        color: #e1e1e1;
        border: 1px solid #30475e;
      }

      .dark-mode .word-item {
        background: #16213e;
        color: #e1e1e1;
        border: 1px solid #30475e;
      }

      .dark-mode input {
        background: #16213e;
        color: #e1e1e1;
        border: 2px solid #30475e;
      }

      .dark-mode input:focus {
        border-color: #4ecca3;
        box-shadow: 0 0 5px rgba(78, 204, 163, 0.3);
      }

      .dark-mode .header h1 {
        color: #e1e1e1;
      }

      .dark-mode .word-translation {
        color: #a5a5a5;
      }

      .dark-mode .box-header h3 {
        color: #4ecca3;
      }

      .dark-mode .stat-value {
        color: #4ecca3;
      }

      .dark-mode .stat-label {
        color: #a5a5a5;
      }

      .dark-mode .current-date {
        color: #a5a5a5;
      }
      .word-inputs {
        display: flex;
        gap: 10px;
        flex: 2;
      }

      .image-upload {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        flex: 1;
      }

      .image-preview {
        width: 100px;
        height: 100px;
        border: 2px dashed #e0e0e0;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
      }

      .image-preview img {
        max-width: 100%;
        max-height: 100%;
        object-fit: cover;
      }

      .image-preview .remove-image {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(231, 76, 60, 0.8);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
      }

      .image-btn {
        background: #9b59b6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .image-btn:hover {
        background: #8e44ad;
      }

      /* Sửa lại style cho flashcard để hiển thị ảnh */
      .card-image {
        width: 200px;
        height: 200px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 15px;
      }

      .card-image img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 8px;
      }

      .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .card-face.front {
        transform: rotateY(0deg);
      }

      .card-face.back {
        transform: rotateY(180deg);
      }

      .flashcard {
        position: relative;
        width: 100%;
        height: 400px; /* Tăng chiều cao để chứa ảnh */
        transform-style: preserve-3d;
        transition: transform 0.6s;
        cursor: pointer;
      }

      .flashcard.flipped {
        transform: rotateY(180deg);
      }

      .card-content {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .card-word {
        font-size: 28px;
        margin: 10px 0;
      }

      .card-meaning {
        font-size: 24px;
      }
      /* Thông báo xoay màn hình */
      .study-options-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .study-options-container {
        background: white;
        padding: 30px;
        border-radius: 15px;
        width: 90%;
        max-width: 800px;
      }

      .study-options-container h2 {
        text-align: center;
        color: #2d4059;
        margin-bottom: 30px;
      }

      .study-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .study-option-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        background: white;
        transition: all 0.3s;
      }

      .study-option-btn:hover {
        transform: translateY(-5px);
        border-color: #3498db;
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
      }

      .study-option-btn i {
        font-size: 2em;
        margin-bottom: 10px;
        color: #3498db;
      }

      .study-option-btn span {
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 5px;
        color: #2d4059;
      }

      .study-option-btn p {
        font-size: 0.9em;
        color: #666;
        text-align: center;
        margin: 0;
      }

      .close-modal-btn {
        display: block;
        margin: 0 auto;
        padding: 12px 30px;
        background: #e74c3c;
      }

      .close-modal-btn:hover {
        background: #c0392b;
      }

      /* Dark mode styles for study options modal */
      .dark-mode .study-options-container {
        background: #1a1a2e;
      }

      .dark-mode .study-options-container h2 {
        color: #e1e1e1;
      }

      .dark-mode .study-option-btn {
        background: #16213e;
        border-color: #30475e;
      }

      .dark-mode .study-option-btn:hover {
        border-color: #4ecca3;
        box-shadow: 0 5px 15px rgba(78, 204, 163, 0.2);
      }

      .dark-mode .study-option-btn span {
        color: #e1e1e1;
      }

      .dark-mode .study-option-btn p {
        color: #a5a5a5;
      }
      .back-button {
        position: absolute;
        left: 20px;
        top: 20px;
        padding: 10px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
        z-index: 100;
      }

      .back-button:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .header {
        position: relative;
        padding-top: 20px;
      }

      /* Dark mode styles */
      .dark-mode .back-button {
        background: #2c3e50;
        color: #fff;
      }

      .dark-mode .back-button:hover {
        background: #34495e;
      }
      /* Mobile Responsive Styles */
      @media screen and (max-width: 768px) {
        /* Container adjustments */
        .container {
          padding: 10px;
        }

        /* Header adjustments */
        .header h1 {
          font-size: 1.8em;
        }

        .back-button {
          left: 10px;
          top: 10px;
          padding: 8px 15px;
          font-size: 14px;
        }

        /* Statistics cards */
        .statistics {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .stat-card {
          padding: 15px;
        }

        .stat-value {
          font-size: 20px;
        }

        .stat-label {
          font-size: 14px;
        }

        /* Input section */
        .input-section {
          padding: 15px;
        }

        .input-group {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .word-inputs {
          flex-direction: column;
          gap: 15px;
        }

        input {
          padding: 10px;
          font-size: 14px;
        }

        /* Image upload section */
        .image-upload {
          width: 100%;
          flex-direction: row;
          justify-content: space-between;
          align-items: center;
        }

        .image-preview {
          width: 80px;
          height: 80px;
        }

        /* Boxes container */
        .boxes-container {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .box {
          padding: 15px;
          min-height: 100px;
        }

        /* Flashcard adjustments */
        .flashcard-container {
          width: 90%;
          max-width: 350px;
        }

        .flashcard {
          height: 300px;
        }

        .card-face {
          padding: 15px;
        }

        .card-word {
          font-size: 24px;
        }

        .card-meaning {
          font-size: 20px;
        }

        .card-image {
          width: 150px;
          height: 150px;
        }

        /* Study options modal */
        .study-options-container {
          padding: 20px;
        }

        .study-options {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .study-option-btn {
          padding: 15px;
        }

        /* Settings modal */
        .settings-content {
          width: 95%;
          padding: 20px;
        }

        .settings-option {
          padding: 12px 0;
        }

        /* Button adjustments */
        button {
          padding: 10px 20px;
          font-size: 14px;
        }

        .action-btn {
          width: 28px;
          height: 28px;
        }

        /* Word items */
        .word-item {
          padding: 10px;
          flex-direction: column;
          gap: 10px;
        }

        .word-actions {
          width: 100%;
          justify-content: center;
        }

        /* Notification */
        .notification {
          top: 10px;
          right: 10px;
          padding: 12px 20px;
          font-size: 14px;
        }

        /* Settings button */
        .settings-btn {
          bottom: 15px;
          right: 15px;
          width: 45px;
          height: 45px;
        }
      }

      /* Additional improvements for very small screens */
      @media screen and (max-width: 380px) {
        .header h1 {
          font-size: 1.5em;
        }

        .stat-card {
          padding: 12px;
        }

        .stat-value {
          font-size: 18px;
        }

        .card-word {
          font-size: 20px;
        }

        .card-meaning {
          font-size: 18px;
        }

        .card-image {
          width: 120px;
          height: 120px;
        }
      }

      /* Landscape mode warning */
      @media screen and (max-height: 500px) and (orientation: landscape) {
        .flashcard-modal::before {
          content: "Vui lòng xoay điện thoại để xem tốt hơn";
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 20px;
          border-radius: 10px;
          text-align: center;
          z-index: 1002;
        }
      }

      /* Touch device optimizations */
      @media (hover: none) {
        .box:hover,
        .word-item:hover,
        button:hover {
          transform: none;
        }

        .box:active,
        .word-item:active,
        button:active {
          transform: scale(0.98);
        }

        .study-option-btn:active {
          transform: scale(0.98);
          border-color: #3498db;
        }
      }

      /* Better tap targets for mobile */
      @media (max-width: 768px) {
        .action-btn,
        .settings-btn,
        .close-modal-btn {
          min-width: 44px;
          min-height: 44px;
        }

        .word-actions {
          gap: 15px;
        }

        /* Improve scrolling */
        .word-list {
          -webkit-overflow-scrolling: touch;
          scroll-behavior: smooth;
        }

        /* Add pull-to-refresh visual indicator */
        .word-list::before {
          content: "⟳ Kéo xuống để làm mới";
          display: block;
          text-align: center;
          padding: 10px;
          color: #666;
        }
      }

      /* Word Details Panel */
      .flashcard-container {
        display: flex;
        gap: 20px;
        width: 90%;
        max-width: 1200px;
      }

      .word-details-panel {
        flex: 1;
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
        max-height: 600px;
        display: none; /* Initially hidden */
      }

      .dark-mode .word-details-panel {
        background: #1a1a2e;
        color: #e1e1e1;
      }

      .word-details-header {
        margin-bottom: 20px;
      }

      .word-title {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .phonetics {
        display: flex;
        gap: 15px;
        align-items: center;
        margin-bottom: 15px;
      }

      .phonetic-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .pronunciation-btn {
        background: #3498db;
        color: white;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
      }

      .pronunciation-btn:hover {
        background: #2980b9;
      }

      .meaning-section {
        margin-bottom: 20px;
      }

      .part-of-speech {
        font-size: 18px;
        font-weight: 500;
        color: #3498db;
        margin-bottom: 10px;
      }

      .dark-mode .part-of-speech {
        color: #4ecca3;
      }

      .definition-list {
        list-style-type: none;
        padding: 0;
      }

      .definition-item {
        margin-bottom: 15px;
        padding-left: 15px;
        border-left: 3px solid #3498db;
      }

      .dark-mode .definition-item {
        border-left-color: #4ecca3;
      }

      .example {
        margin-top: 5px;
        font-style: italic;
        color: #666;
      }

      .dark-mode .example {
        color: #a5a5a5;
      }

      .synonyms,
      .antonyms {
        margin-top: 10px;
      }

      .synonyms span,
      .antonyms span {
        display: inline-block;
        margin: 3px;
        padding: 3px 8px;
        background: #f0f0f0;
        border-radius: 12px;
        font-size: 14px;
      }

      .dark-mode .synonyms span,
      .dark-mode .antonyms span {
        background: #16213e;
      }

      .loading-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 200px;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      /* Dictionary Panel Styles */
      .flashcard-container {
        display: flex;
        gap: 20px;
        width: 90%;
        max-width: 1200px;
      }

      .card-section {
        flex: 1;
        min-width: 300px;
      }

      .dictionary-panel {
        flex: 1;
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-height: 600px;
        overflow-y: auto;
      }

      .dark-mode .dictionary-panel {
        background: #1a1a2e;
        color: #e1e1e1;
      }

      .dictionary-content h3 {
        color: #3498db;
        margin-bottom: 20px;
      }

      .dark-mode .dictionary-content h3 {
        color: #4ecca3;
      }

      .phonetic-section {
        margin-bottom: 20px;
      }

      .phonetic-item {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
      }

      .phonetic-text {
        font-family: monospace;
        font-size: 1.1em;
      }

      .meaning-section {
        margin-bottom: 25px;
      }

      .part-of-speech {
        color: #3498db;
        font-weight: bold;
        font-size: 1.1em;
        margin-bottom: 10px;
      }

      .dark-mode .part-of-speech {
        color: #4ecca3;
      }

      .definition-item {
        margin-bottom: 15px;
        padding-left: 15px;
        border-left: 3px solid #3498db;
      }

      .dark-mode .definition-item {
        border-left-color: #4ecca3;
      }

      .definition-text {
        margin-bottom: 5px;
      }

      .example-text {
        color: #666;
        font-style: italic;
        margin-top: 5px;
      }

      .dark-mode .example-text {
        color: #a5a5a5;
      }

      .synonyms-section,
      .antonyms-section {
        margin-top: 10px;
      }

      .word-tag {
        display: inline-block;
        background: #f0f0f0;
        padding: 3px 8px;
        border-radius: 12px;
        margin: 3px;
        font-size: 0.9em;
      }

      .dark-mode .word-tag {
        background: #16213e;
      }

      /* Dictionary Button Styles */
      .card-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 10px;
      }

      .dictionary-btn {
        background: #9b59b6;
      }

      .dictionary-btn:hover {
        background: #8e44ad;
      }
      /* Dictionary Overlay */
      .dictionary-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
      }

      /* Dictionary Panel */
      .dictionary-panel {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 600px;
        max-height: 85vh;
        margin: 0;
        animation: slideIn 0.3s ease-out;
        display: flex;
        flex-direction: column;
      }

      /* Dictionary Header */
      .dictionary-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid #eef2f5;
        background: white;
        position: sticky;
        top: 0;
        z-index: 10;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
      }

      .dictionary-header h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #2d3436;
        margin: 0;
      }

      .close-dictionary-btn {
        background: none;
        border: none;
        color: #636e72;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        width: 36px;
        height: 36px;
      }

      .close-dictionary-btn:hover {
        background: #f5f6fa;
        color: #e74c3c;
      }

      /* Dictionary Content */
      .dictionary-content {
        padding: 20px 24px;
        overflow-y: auto;
        max-height: calc(85vh - 80px);
      }

      /* Phonetic Section */
      .phonetic-section {
        margin-bottom: 24px;
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: center;
      }

      .phonetic-item {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #f5f6fa;
        padding: 8px 16px;
        border-radius: 50px;
      }

      .phonetic-text {
        color: #2d3436;
        font-family: monospace;
        font-size: 1rem;
      }

      /* Pronunciation Button */
      .pronunciation-btn {
        background: #3498db;
        color: white;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        padding: 0;
      }

      .pronunciation-btn:hover {
        background: #2980b9;
        transform: scale(1.1);
      }

      /* Meaning Section */
      .meaning-section {
        margin-bottom: 28px;
      }

      .part-of-speech {
        color: #3498db;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 16px;
        text-transform: capitalize;
      }

      .definition-item {
        margin-bottom: 16px;
        padding-left: 16px;
        border-left: 3px solid #3498db;
      }

      .definition-text {
        color: #2d3436;
        font-size: 1rem;
        line-height: 1.5;
        margin: 0 0 8px 0;
      }

      .example-text {
        color: #636e72;
        font-style: italic;
        font-size: 0.95rem;
        margin: 8px 0 0 0;
        line-height: 1.4;
      }

      /* Word Tags */
      .synonyms-section,
      .antonyms-section {
        margin-top: 16px;
      }

      .word-tag {
        display: inline-block;
        background: #f5f6fa;
        color: #2d3436;
        padding: 4px 12px;
        border-radius: 50px;
        margin: 4px;
        font-size: 0.9rem;
        transition: all 0.2s ease;
      }

      .word-tag:hover {
        background: #e2e8f0;
      }

      /* Loading State */
      .loading {
        text-align: center;
        padding: 40px;
        color: #636e72;
        font-size: 1rem;
      }

      /* Error Message */
      .error-message {
        text-align: center;
        padding: 40px;
        color: #e74c3c;
        font-size: 1rem;
      }

      /* Dark Mode Styles */
      .dark-mode .dictionary-panel {
        background: #1a1a2e;
        border: 1px solid #30475e;
      }

      .dark-mode .dictionary-header {
        background: #1a1a2e;
        border-bottom-color: #30475e;
      }

      .dark-mode .dictionary-header h3 {
        color: #fff;
      }

      .dark-mode .close-dictionary-btn {
        color: #a5a5a5;
      }

      .dark-mode .close-dictionary-btn:hover {
        background: #222831;
        color: #e74c3c;
      }

      .dark-mode .phonetic-item {
        background: #222831;
      }

      .dark-mode .phonetic-text {
        color: #fff;
      }

      .dark-mode .definition-text {
        color: #fff;
      }

      .dark-mode .example-text {
        color: #a5a5a5;
      }

      .dark-mode .word-tag {
        background: #222831;
        color: #fff;
      }

      .dark-mode .word-tag:hover {
        background: #30475e;
      }

      /* Animation */
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translate(-50%, -60%);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%);
        }
      }

      /* Scrollbar Styles */
      .dictionary-content::-webkit-scrollbar {
        width: 8px;
      }

      .dictionary-content::-webkit-scrollbar-track {
        background: transparent;
      }

      .dictionary-content::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 4px;
      }

      .dark-mode .dictionary-content::-webkit-scrollbar-thumb {
        background: #30475e;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .dictionary-panel {
          width: 95%;
          max-height: 90vh;
        }

        .dictionary-header {
          padding: 16px 20px;
        }

        .dictionary-content {
          padding: 16px 20px;
          max-height: calc(90vh - 70px);
        }
      }
      /* Dictionary Styles */
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Vocabulary Learning System</h1>
        <div class="current-date" id="currentDate"></div>
      </div>

      <div class="statistics">
        <div class="stat-card">
          <div class="stat-value" id="totalWords">0</div>
          <div class="stat-label">Total Words</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="masteredWords">0</div>
          <div class="stat-label">Mastered Words</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="learningStreak">0</div>
          <div class="stat-label">Day Streak</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="reviewAccuracy">0%</div>
          <div class="stat-label">Review Accuracy</div>
        </div>
      </div>

      <div class="chart-container">
        <canvas id="retentionChart"></canvas>
      </div>

      <div class="input-section">
        <div class="search-bar">
          <input
            type="text"
            id="searchWords"
            placeholder="Search words..."
            oninput="vocabularyManager.filterWords(this.value)"
          />
        </div>
        <div class="input-group">
          <div class="word-inputs">
            <input
              type="text"
              id="englishWord"
              placeholder="Enter English word"
            />
            <input
              type="text"
              id="vietnameseMeaning"
              placeholder="Enter Vietnamese meaning"
            />
          </div>
          <div class="image-upload">
            <label for="wordImage" class="image-upload-label">
              <i class="fas fa-image"></i>
              <span>Add Image</span>
              <input
                type="file"
                id="wordImage"
                accept="image/*"
                capture="environment"
                style="display: none"
              />
            </label>
            <div id="imagePreview" class="image-preview"></div>
          </div>
          <div class="action-buttons">
            <button onclick="vocabularyManager.addWord()">
              <i class="fas fa-plus"></i> Add Word
            </button>
          </div>
        </div>
      </div>

      <div class="boxes-container">
        <div class="box" onclick="vocabularyManager.showStudyOptions(100)">
          <div class="box-header">
            <h3>Mastered</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(75)">
          <div class="box-header">
            <h3>Learning</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(50)">
          <div class="box-header">
            <h3>Practicing</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(25)">
          <div class="box-header">
            <h3>Beginning</h3>
            <span class="word-count">0</span>
          </div>
        </div>
        <div class="box" onclick="vocabularyManager.showStudyOptions(0)">
          <div class="box-header">
            <h3>New</h3>
            <span class="word-count">0</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Flashcard Modal -->
    <div class="flashcard-modal" id="flashcardModal">
      <div class="flashcard-container">
        <div class="card-section">
          <div class="flashcard">
            <div class="card-face front">
              <div class="card-content">
                <div class="card-image"></div>
                <div class="card-word"></div>
                <div class="card-actions">
                  <button
                    class="audio-btn action-btn"
                    onclick="event.stopPropagation(); vocabularyManager.playAudio(document.querySelector('.card-word').textContent)"
                  >
                    <i class="fas fa-volume-up"></i>
                  </button>
                  <button
                    class="dictionary-btn action-btn"
                    onclick="event.stopPropagation(); vocabularyManager.toggleDictionary()"
                  >
                    <i class="fas fa-book"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="card-face back">
              <div class="card-content">
                <div class="card-meaning"></div>
              </div>
            </div>
          </div>
          <div class="card-controls">
            <button onclick="vocabularyManager.previousCard()">
              <i class="fas fa-chevron-left"></i> Previous
            </button>
            <button onclick="vocabularyManager.closeFlashcards()">
              <i class="fas fa-times"></i> Close
            </button>
            <button onclick="vocabularyManager.nextCard()">
              Next <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>

        <!-- Dictionary Panel -->
        <!-- Dictionary Panel -->
        <!-- Dictionary Panel -->
        <div class="dictionary-overlay" id="dictionaryOverlay">
          <div class="dictionary-panel" id="dictionaryPanel">
            <div class="dictionary-header">
              <h3>Dictionary</h3>
              <button class="close-dictionary-btn" id="closeDictionaryBtn">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="dictionary-content" id="dictionaryContent">
              <div class="dictionary-data"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="settings-modal" id="settingsModal">
      <div class="settings-content">
        <div class="settings-header">
          <h2>Settings</h2>
          <span
            class="settings-close"
            onclick="vocabularyManager.closeSettings()"
            >&times;</span
          >
        </div>
        <div class="settings-option">
          <span>Dark Mode</span>
          <label class="switch">
            <input
              type="checkbox"
              id="darkModeToggle"
              onchange="vocabularyManager.toggleDarkMode()"
            />
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span>Auto-play Pronunciation</span>
          <label class="switch">
            <input type="checkbox" id="autoPlayToggle" />
            <span class="slider"></span>
          </label>
        </div>
        <div class="settings-option">
          <span>Reset Progress</span>
          <button
            onclick="vocabularyManager.resetProgress()"
            style="background-color: #e74c3c"
          >
            Reset
          </button>
        </div>
      </div>
    </div>

    <button class="settings-btn" onclick="vocabularyManager.openSettings()">
      <i class="fas fa-cog"></i>
    </button>

    <div class="notification" id="notification"></div>
    <script>
      class VocabularyManager {
        constructor() {
          // Lấy thông tin thư mục hiện tại
          this.currentFolderId = localStorage.getItem("current_folder_id");
          this.currentFolderName = localStorage.getItem("current_folder_name");

          // Nếu không có folder ID, quay về trang index
          if (!this.currentFolderId) {
            window.location.href = "index.html";
            return;
          }

          this.vocabulary = [];
          this.currentCardIndex = 0;
          this.currentLevel = null;
          this.settings = this.loadSettings();
          this.streak = this.loadStreak();
          this.lastStudyDate = localStorage.getItem("lastStudyDate");
          this.currentImage = null;

          // Initialize
          this.loadVocabulary();
          this.initChart();
          this.setupEventListeners();
          this.updateDisplay();
          this.updateCurrentDate();
          this.checkAndUpdateLevels();

          // Check streak and levels every minute
          setInterval(() => {
            this.checkAndUpdateLevels();
            this.updateCurrentDate();
          }, 60000);

          // Check when tab becomes visible
          document.addEventListener("visibilitychange", () => {
            if (document.visibilityState === "visible") {
              this.checkAndUpdateLevels();
              this.updateCurrentDate();
            }
          });
        }

        loadSettings() {
          return (
            JSON.parse(localStorage.getItem("settings")) || {
              darkMode: false,
              autoPlay: false,
              notificationInterval: 30,
            }
          );
        }

        saveSettings() {
          localStorage.setItem("settings", JSON.stringify(this.settings));
        }

        loadStreak() {
          return parseInt(localStorage.getItem("streak")) || 0;
        }

        updateCurrentDate() {
          const now = new Date();
          const options = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          };
          document.getElementById("currentDate").textContent =
            now.toLocaleDateString("en-US", options);
        }

        initChart() {
          const ctx = document
            .getElementById("retentionChart")
            .getContext("2d");
          this.chart = new Chart(ctx, {
            type: "line",
            data: {
              labels: [
                "Day 1",
                "Day 2",
                "Day 3",
                "Day 4",
                "Day 5",
                "Day 6",
                "Day 7",
              ],
              datasets: [
                {
                  label: "Memory Retention",
                  data: [100, 75, 50, 25, 10, 5, 0],
                  borderColor: "#3498db",
                  backgroundColor: "rgba(52, 152, 219, 0.1)",
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false,
                },
              },
              scales: {
                y: {
                  beginAtZero: true,
                  max: 100,
                },
              },
            },
          });
        }

        loadVocabulary() {
          try {
            // Lấy danh sách thư mục
            const folders = JSON.parse(
              localStorage.getItem("vocabulary_folders") || "[]"
            );
            // Tìm thư mục hiện tại
            const currentFolder = folders.find(
              (f) => f.id === this.currentFolderId
            );
            // Lấy từ vựng từ thư mục
            this.vocabulary = currentFolder
              ? currentFolder.vocabulary || []
              : [];
          } catch (error) {
            console.error("Error loading vocabulary:", error);
            this.vocabulary = [];
          }
        }

        saveVocabulary() {
          try {
            // Lấy danh sách thư mục
            const folders = JSON.parse(
              localStorage.getItem("vocabulary_folders") || "[]"
            );
            // Tìm vị trí thư mục hiện tại
            const folderIndex = folders.findIndex(
              (f) => f.id === this.currentFolderId
            );

            if (folderIndex !== -1) {
              // Cập nhật từ vựng và thông tin thư mục
              folders[folderIndex].vocabulary = this.vocabulary;
              folders[folderIndex].wordCount = this.vocabulary.length;
              folders[folderIndex].lastModified = new Date().toISOString();

              // Lưu lại vào localStorage
              localStorage.setItem(
                "vocabulary_folders",
                JSON.stringify(folders)
              );
              this.updateDisplay();
              this.updateStatistics();
            }
          } catch (error) {
            console.error("Error saving vocabulary:", error);
            this.showNotification("Couldn't save vocabulary", "error");
          }
        }
        // Add these methods inside the VocabularyManager class, before the last closing brace
        async fetchWordDetails(word) {
          try {
            const response = await fetch(
              `https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(
                word
              )}`
            );
            if (!response.ok) {
              throw new Error("Word not found");
            }
            return await response.json();
          } catch (error) {
            console.error("Error fetching word details:", error);
            return null;
          }
        }

        async updateWordDetails(word) {
          const detailsPanel = document.getElementById("wordDetailsPanel");
          detailsPanel.style.display = "block";

          // Show loading indicator
          detailsPanel.innerHTML = `
    <div class="loading-indicator">
      <div class="loading-spinner"></div>
    </div>
  `;

          const details = await this.fetchWordDetails(word);

          if (!details || !details.length) {
            detailsPanel.innerHTML = `
      <div class="word-details-header">
        <div class="word-title">${word}</div>
        <p>No detailed information found for this word.</p>
      </div>
    `;
            return;
          }

          const wordData = details[0];
          let html = `
    <div class="word-details-header">
      <div class="word-title">${wordData.word}</div>
      <div class="phonetics">
  `;

          // Add phonetics with audio
          wordData.phonetics.forEach((phonetic) => {
            if (phonetic.text && phonetic.audio) {
              html += `
        <div class="phonetic-item">
          <span>${phonetic.text}</span>
          <button class="pronunciation-btn" onclick="vocabularyManager.playAudioUrl('${phonetic.audio}')">
            <i class="fas fa-volume-up"></i>
          </button>
        </div>
      `;
            }
          });

          html += `</div>`; // Close phonetics div

          // Add meanings
          wordData.meanings.forEach((meaning) => {
            html += `
      <div class="meaning-section">
        <div class="part-of-speech">${meaning.partOfSpeech}</div>
        <ul class="definition-list">
    `;

            meaning.definitions.forEach((def) => {
              html += `
        <li class="definition-item">
          <div class="definition">${def.definition}</div>
          ${def.example ? `<div class="example">"${def.example}"</div>` : ""}
        </li>
      `;
            });

            // Add synonyms and antonyms if available
            if (meaning.synonyms.length > 0) {
              html += `
        <div class="synonyms">
          <strong>Synonyms: </strong>
          ${meaning.synonyms.map((s) => `<span>${s}</span>`).join("")}
        </div>
      `;
            }

            if (meaning.antonyms.length > 0) {
              html += `
        <div class="antonyms">
          <strong>Antonyms: </strong>
          ${meaning.antonyms.map((a) => `<span>${a}</span>`).join("")}
        </div>
      `;
            }

            html += `
        </ul>
      </div>
    `;
          });

          detailsPanel.innerHTML = html;
        }

        playAudioUrl(url) {
          const audio = new Audio(url);
          audio.play().catch((error) => {
            console.error("Error playing audio:", error);
            this.showNotification("Could not play pronunciation", "error");
          });
        }
        checkAndUpdateLevels() {
          const now = Date.now();
          let hasChanges = false;

          this.vocabulary = this.vocabulary.map((word) => {
            if (!word.startTime) return word;

            const timeElapsed = now - word.startTime;
            let newLevel = word.level;

            if (timeElapsed >= 240000) {
              newLevel = 0;
            } else if (timeElapsed >= 180000) {
              newLevel = 25;
            } else if (timeElapsed >= 120000) {
              newLevel = 50;
            } else if (timeElapsed >= 60000) {
              newLevel = 75;
            }

            if (newLevel !== word.level) {
              hasChanges = true;
              return { ...word, level: newLevel, lastReviewed: now };
            }

            return word;
          });

          if (hasChanges) {
            this.saveVocabulary();
          }
        }

        updateStatistics() {
          const totalWords = this.vocabulary.length;
          const masteredWords = this.vocabulary.filter(
            (w) => w.level === 100
          ).length;
          const totalReviews = this.vocabulary.reduce(
            (sum, w) => sum + w.reviewCount,
            0
          );
          const totalMistakes = this.vocabulary.reduce(
            (sum, w) => sum + w.mistakes,
            0
          );

          const accuracy =
            totalReviews > 0
              ? Math.round(
                  ((totalReviews - totalMistakes) / totalReviews) * 100
                )
              : 0;

          document.getElementById("totalWords").textContent = totalWords;
          document.getElementById("masteredWords").textContent = masteredWords;
          document.getElementById("learningStreak").textContent = this.streak;
          document.getElementById(
            "reviewAccuracy"
          ).textContent = `${accuracy}%`;
        }

        handleImageUpload(event) {
          const file = event.target.files[0];
          if (!file) return;

          if (file.size > 5 * 1024 * 1024) {
            this.showNotification("File size should be less than 5MB", "error");
            return;
          }

          if (!file.type.startsWith("image/")) {
            this.showNotification("Please select an image file", "error");
            return;
          }

          const reader = new FileReader();

          reader.onload = (e) => {
            try {
              const img = new Image();

              img.onload = () => {
                const maxWidth = 800;
                const maxHeight = 800;

                let width = img.width;
                let height = img.height;

                if (width > maxWidth || height > maxHeight) {
                  if (width > height) {
                    height *= maxWidth / width;
                    width = maxWidth;
                  } else {
                    width *= maxHeight / height;
                    height = maxHeight;
                  }
                }

                const canvas = document.createElement("canvas");
                canvas.width = width;
                canvas.height = height;

                const ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, width, height);

                const resizedImage = canvas.toDataURL(file.type, 0.8);

                const imagePreview = document.getElementById("imagePreview");
                imagePreview.innerHTML = `<img src="${resizedImage}" alt="Preview">`;

                if (this.vocabulary.length > 0 && this.currentCardIndex >= 0) {
                  const words = this.vocabulary.filter(
                    (word) => word.level === this.currentLevel
                  );
                  if (words.length > 0) {
                    const currentWord = words[this.currentCardIndex];
                    const wordIndex = this.vocabulary.findIndex(
                      (w) => w.id === currentWord.id
                    );
                    if (wordIndex !== -1) {
                      this.vocabulary[wordIndex].image = resizedImage;
                      this.saveVocabulary();
                      this.updateFlashcard();
                      this.showNotification("Image added successfully!");
                    }
                  }
                } else {
                  this.currentImage = resizedImage;
                }
              };

              img.src = e.target.result;
            } catch (error) {
              console.error("Error processing image:", error);
              this.showNotification("Error processing image", "error");
            }
          };

          reader.onerror = (error) => {
            console.error("Error reading file:", error);
            this.showNotification("Error reading file", "error");
          };

          reader.readAsDataURL(file);
          event.target.value = "";
        }

        updateImagePreview() {
          const preview = document.getElementById("imagePreview");
          if (this.currentImage) {
            preview.innerHTML = `
                <img src="${this.currentImage}" alt="Word image">
                <button class="remove-image" onclick="vocabularyManager.removeImage()">
                  <i class="fas fa-times"></i>
                </button>
              `;
          } else {
            preview.innerHTML = "";
          }
        }

        removeImage() {
          this.currentImage = null;
          this.updateImagePreview();
          document.getElementById("wordImage").value = "";
        }
        addWord() {
          const englishInput = document.getElementById("englishWord");
          const vietnameseInput = document.getElementById("vietnameseMeaning");

          const english = this.sanitizeInput(englishInput.value);
          const vietnamese = this.sanitizeInput(vietnameseInput.value);

          if (!this.validateInputs(english, vietnamese)) return;

          const newWord = {
            id: this.generateUniqueId(),
            english,
            vietnamese,
            level: 100,
            startTime: Date.now(),
            lastReviewed: null,
            reviewCount: 0,
            mistakes: 0,
            image: this.currentImage,
          };

          this.vocabulary.push(newWord);
          this.saveVocabulary();
          this.clearInputs(englishInput, vietnameseInput);
          this.removeImage();
          this.showNotification(`Added: ${english}`);

          if (this.settings.autoPlay) {
            this.playAudio(english);
          }
        }

        createWordHTML(word) {
          return `
          <div class="word-item" data-id="${word.id}">
            <div class="word-content">
              ${
                word.image
                  ? `<div class="word-image"><img src="${word.image}" alt="${word.english}"></div>`
                  : ""
              }
              <div class="word-text">${word.english}</div>
              <div class="word-translation">${word.vietnamese}</div>
            </div>
            <div class="word-actions">
              <button class="audio-btn action-btn" onclick="event.stopPropagation(); vocabularyManager.playAudio('${
                word.english
              }')">
                <i class="fas fa-volume-up"></i>
              </button>
              <button class="delete-btn action-btn" onclick="event.stopPropagation(); vocabularyManager.deleteWord('${
                word.id
              }')">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        `;
        }

        deleteWord(id) {
          try {
            const wordIndex = this.vocabulary.findIndex((w) => w.id === id);
            if (wordIndex !== -1) {
              const deletedWord = this.vocabulary[wordIndex];
              this.vocabulary.splice(wordIndex, 1);
              this.saveVocabulary();
              this.showNotification(`Deleted: ${deletedWord.english}`);
            }
          } catch (error) {
            console.error("Error deleting word:", error);
            this.showNotification("Couldn't delete word", "error");
          }
        }

        updateDisplay() {
          const levels = [100, 75, 50, 25, 0];
          levels.forEach((level) => {
            const wordsAtLevel = this.vocabulary.filter(
              (word) => word.level === level
            );
            const box = document.querySelector(
              `[onclick="vocabularyManager.showStudyOptions(${level})"]`
            );
            if (box) {
              const countSpan = box.querySelector(".word-count");
              countSpan.textContent = wordsAtLevel.length;
            }
          });
        }
        toggleDictionary() {
          const dictionaryPanel = document.getElementById("dictionaryPanel");
          const overlay = document.querySelector(".dictionary-overlay");
          const isVisible = dictionaryPanel.style.display === "block";

          if (!overlay) {
            const newOverlay = document.createElement("div");
            newOverlay.className = "dictionary-overlay";
            document.body.appendChild(newOverlay);

            // Fix: Add stopPropagation to prevent click events from bubbling up
            newOverlay.addEventListener("click", (e) => {
              e.stopPropagation();
              if (e.target === newOverlay) {
                this.toggleDictionary();
              }
            });
          }

          if (!isVisible) {
            dictionaryPanel.style.display = "block";
            overlay.style.display = "block";
            const currentWord =
              document.querySelector(".card-word").textContent;
            this.fetchAndDisplayDictionary(currentWord);
            document.body.style.overflow = "hidden";

            // Fix: Add z-index to ensure dictionary panel is above other elements
            dictionaryPanel.style.zIndex = "1051";
            overlay.style.zIndex = "1050";
          } else {
            dictionaryPanel.style.display = "none";
            overlay.style.display = "none";
            document.body.style.overflow = "auto";
          }
        }

        async updateFlashcard() {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          if (words.length > 0) {
            const currentWord = words[this.currentCardIndex];
            const cardWord = document.querySelector(".card-word");
            const cardMeaning = document.querySelector(".card-meaning");
            const cardImage = document.querySelector(
              ".card-face.front .card-image"
            );

            cardWord.textContent = currentWord.english;
            cardMeaning.textContent = currentWord.vietnamese;

            if (currentWord.image) {
              cardImage.innerHTML = `<img src="${currentWord.image}" alt="${currentWord.english}" style="max-width: 200px; max-height: 200px; border-radius: 8px;">`;
            } else {
              cardImage.innerHTML = "";
            }

            const flashcard = document.querySelector(".flashcard");
            flashcard.classList.remove("flipped");

            // Reset dictionary panel display
            const dictionaryPanel = document.getElementById("dictionaryPanel");
            dictionaryPanel.style.display = "none";
            const overlay = document.querySelector(".dictionary-overlay");
            if (overlay) {
              overlay.style.display = "none";
            }
          }
        }

        async fetchAndDisplayDictionary(word) {
          const dictionaryPanel = document.querySelector(".dictionary-data");

          try {
            const response = await fetch(
              `https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(
                word
              )}`
            );
            if (!response.ok) throw new Error("Word not found");

            const data = await response.json();
            if (data && data.length > 0) {
              const wordData = data[0];
              let html = '<div class="dictionary-content">';

              // Phonetics section with improved audio buttons
              if (wordData.phonetics && wordData.phonetics.length > 0) {
                html += '<div class="phonetic-section">';
                wordData.phonetics.forEach((phonetic) => {
                  if (phonetic.text || phonetic.audio) {
                    html += `
                            <div class="phonetic-item">
                                ${
                                  phonetic.text
                                    ? `<span class="phonetic-text">${phonetic.text}</span>`
                                    : ""
                                }
                                ${
                                  phonetic.audio
                                    ? `
                                    <button class="pronunciation-btn" onclick="vocabularyManager.playAudioUrl('${phonetic.audio}')">
                                        <i class="fas fa-volume-up"></i>
                                    </button>
                                `
                                    : ""
                                }
                            </div>
                        `;
                  }
                });
                html += "</div>";
              }

              // Meanings section
              if (wordData.meanings) {
                wordData.meanings.forEach((meaning) => {
                  html += `
                        <div class="meaning-section">
                            <h4 class="part-of-speech">${meaning.partOfSpeech}</h4>
                            <div class="definitions">
                    `;

                  meaning.definitions.forEach((def) => {
                    html += `
                            <div class="definition-item">
                                <p class="definition-text">• ${
                                  def.definition
                                }</p>
                                ${
                                  def.example
                                    ? `<p class="example-text">"${def.example}"</p>`
                                    : ""
                                }
                            </div>
                        `;
                  });

                  if (meaning.synonyms && meaning.synonyms.length > 0) {
                    html += `
                            <div class="synonyms-section">
                                <strong>Synonyms:</strong>
                                ${meaning.synonyms
                                  .map(
                                    (s) => `<span class="word-tag">${s}</span>`
                                  )
                                  .join(" ")}
                            </div>
                        `;
                  }

                  if (meaning.antonyms && meaning.antonyms.length > 0) {
                    html += `
                            <div class="antonyms-section">
                                <strong>Antonyms:</strong>
                                ${meaning.antonyms
                                  .map(
                                    (a) => `<span class="word-tag">${a}</span>`
                                  )
                                  .join(" ")}
                            </div>
                        `;
                  }

                  html += `
                            </div>
                        </div>
                    `;
                });
              }

              html += "</div>";
              dictionaryPanel.innerHTML = html;
            }
          } catch (error) {
            dictionaryPanel.innerHTML = `
            <div class="error-message">
                No dictionary data available for "${word}"
            </div>
        `;
          }
        }
        showFlashcards(level) {
          const words = this.vocabulary.filter((word) => word.level === level);
          if (words.length === 0) {
            this.showNotification("No words at this level", "error");
            return;
          }

          this.currentLevel = level;
          this.currentCardIndex = 0;

          const flashcardModal = document.getElementById("flashcardModal");
          flashcardModal.style.display = "flex";

          // Gọi updateFlashcard để hiển thị từ đầu tiên và thông tin từ điển
          this.updateFlashcard();

          const flashcard = document.querySelector(".flashcard");
          if (flashcard) {
            const oldFlashcard = flashcard.cloneNode(true);
            flashcard.parentNode.replaceChild(oldFlashcard, flashcard);
            oldFlashcard.addEventListener("click", (e) => this.flipCard(e));
          }
        }
        playAudioUrl(url) {
          const audio = new Audio(url);
          audio.play().catch((error) => {
            console.error("Error playing audio:", error);
            this.showNotification("Could not play pronunciation", "error");
          });
        }

        flipCard(event) {
          // Kiểm tra xem click có phải từ các phần tử không nên gây lật thẻ
          if (
            event &&
            (event.target.closest(".dictionary-panel") ||
              event.target.closest(".dictionary-overlay") ||
              event.target.closest(".audio-btn") ||
              event.target.closest(".dictionary-btn") ||
              event.target.closest(".action-btn"))
          ) {
            return;
          }

          const flashcard = document.querySelector(".flashcard");
          if (!flashcard) return;

          // Kiểm tra xem dictionary panel có đang mở không
          const dictionaryPanel = document.getElementById("dictionaryPanel");
          if (dictionaryPanel && dictionaryPanel.style.display === "block") {
            return; // Không lật thẻ nếu dictionary đang mở
          }

          // Thực hiện lật thẻ
          flashcard.classList.toggle("flipped");

          // Phát âm thanh nếu cài đặt auto-play được bật và thẻ đang ở mặt trước
          if (
            this.settings.autoPlay &&
            !flashcard.classList.contains("flipped")
          ) {
            const word = document.querySelector(".card-word").textContent;
            this.playAudio(word);
          }

          // Cập nhật trạng thái từ nếu cần
          const currentWord = this.vocabulary.find(
            (word) =>
              word.english === document.querySelector(".card-word").textContent
          );
          if (currentWord) {
            currentWord.lastReviewed = Date.now();
            this.saveVocabulary();
          }
        }

        nextCard() {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          this.currentCardIndex = (this.currentCardIndex + 1) % words.length;
          this.updateFlashcard();
        }

        previousCard() {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          this.currentCardIndex =
            (this.currentCardIndex - 1 + words.length) % words.length;
          this.updateFlashcard();
        }

        setupEventListeners() {
          // Thêm nút Back
          const headerDiv = document.querySelector(".header");
          if (headerDiv) {
            const backButton = document.createElement("button");
            backButton.className = "back-button";
            backButton.innerHTML =
              '<i class="fas fa-arrow-left"></i> Back to Folders';
            backButton.onclick = () => (window.location.href = "index.html");
            headerDiv.insertBefore(backButton, headerDiv.firstChild);
          }

          // Cập nhật tiêu đề
          const title = document.querySelector(".header h1");
          if (title && this.currentFolderName) {
            title.textContent = `Vocabulary - ${this.currentFolderName}`;
          }

          // Event listeners cho input fields
          document
            .getElementById("englishWord")
            .addEventListener("keypress", (e) => {
              if (e.key === "Enter") {
                document.getElementById("vietnameseMeaning").focus();
              }
            });

          document
            .getElementById("vietnameseMeaning")
            .addEventListener("keypress", (e) => {
              if (e.key === "Enter") {
                this.addWord();
              }
            });

          // Keyboard shortcuts
          document.addEventListener("keydown", (e) => {
            if (
              document.getElementById("flashcardModal").style.display === "flex"
            ) {
              switch (e.key) {
                case "ArrowRight":
                  this.nextCard();
                  break;
                case "ArrowLeft":
                  this.previousCard();
                  break;
                case " ":
                  this.flipCard();
                  e.preventDefault();
                  break;
                case "Escape":
                  this.closeFlashcards();
                  break;
              }
            }
          });

          // Flashcard interaction
          const flashcard = document.querySelector(".flashcard");
          if (flashcard) {
            flashcard.addEventListener("click", (e) => this.flipCard(e));
          }

          // Image upload handling
          const imageInput = document.getElementById("wordImage");
          if (imageInput) {
            imageInput.addEventListener("change", (e) =>
              this.handleImageUpload(e)
            );
          }

          // Dictionary specific event listeners
          const dictionaryPanel = document.getElementById("dictionaryPanel");
          if (dictionaryPanel) {
            // Ngăn chặn sự kiện click lan truyền từ dictionary panel
            dictionaryPanel.addEventListener("click", (e) => {
              e.stopPropagation();
            });

            // Event listener cho nút đóng dictionary
            const closeBtn = dictionaryPanel.querySelector(
              ".close-dictionary-btn"
            );
            if (closeBtn) {
              closeBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                this.toggleDictionary();
              });
            }

            // Ngăn chặn đóng dictionary khi click vào nội dung
            const dictionaryContent = dictionaryPanel.querySelector(
              ".dictionary-content"
            );
            if (dictionaryContent) {
              dictionaryContent.addEventListener("click", (e) => {
                e.stopPropagation();
              });
            }
          }

          // Handle dictionary overlay
          const overlay = document.querySelector(".dictionary-overlay");
          if (!overlay) {
            const newOverlay = document.createElement("div");
            newOverlay.className = "dictionary-overlay";
            document.body.appendChild(newOverlay);

            newOverlay.addEventListener("click", (e) => {
              if (e.target === newOverlay) {
                this.toggleDictionary();
              }
            });
          }

          // Setup touch events
          this.setupTouchEvents();

          // Apply dark mode if enabled
          if (this.settings.darkMode) {
            document.body.classList.add("dark-mode");
          }

          // Settings button event listeners
          const settingsBtn = document.querySelector(".settings-btn");
          if (settingsBtn) {
            settingsBtn.addEventListener("click", () => this.openSettings());
          }

          // Dictionary buttons in flashcards
          const dictionaryBtns = document.querySelectorAll(".dictionary-btn");
          dictionaryBtns.forEach((btn) => {
            btn.addEventListener("click", (e) => {
              e.stopPropagation();
              this.toggleDictionary();
            });
          });

          // Audio buttons in flashcards
          const audioBtns = document.querySelectorAll(".audio-btn");
          audioBtns.forEach((btn) => {
            btn.addEventListener("click", (e) => {
              e.stopPropagation();
              const word = document.querySelector(".card-word").textContent;
              this.playAudio(word);
            });
          });
        }

        setupTouchEvents() {
          const flashcard = document.querySelector(".flashcard");
          if (flashcard) {
            let touchStartX = 0;
            let touchStartY = 0;

            flashcard.addEventListener(
              "touchstart",
              (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
              },
              { passive: true }
            );

            flashcard.addEventListener(
              "touchend",
              (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const deltaX = touchEndX - touchStartX;
                const deltaY = touchEndY - touchStartY;

                if (Math.abs(deltaX) > 50 && Math.abs(deltaY) < 30) {
                  if (deltaX > 0) {
                    this.previousCard();
                  } else {
                    this.nextCard();
                  }
                } else if (Math.abs(deltaY) > 50 && Math.abs(deltaX) < 30) {
                  this.flipCard();
                }
              },
              { passive: true }
            );
          }

          const settingsBtn = document.querySelector(".settings-btn");
          if (settingsBtn) {
            settingsBtn.addEventListener("touchstart", (e) => {
              e.preventDefault();
              this.openSettings();
            });
          }

          const closeBtn = document.querySelector(".settings-close");
          if (closeBtn) {
            closeBtn.addEventListener("touchstart", (e) => {
              e.preventDefault();
              this.closeSettings();
            });
          }
        }

        playAudio(word) {
          try {
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = "en-US";
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
          } catch (error) {
            console.error("Error playing audio:", error);
            this.showNotification("Couldn't play audio", "error");
          }
        }

        filterWords(query) {
          const normalizedQuery = query.toLowerCase().trim();
          const filteredWords = this.vocabulary.filter(
            (word) =>
              word.english.toLowerCase().includes(normalizedQuery) ||
              word.vietnamese.toLowerCase().includes(normalizedQuery)
          );
          this.displayFilteredWords(filteredWords);
        }

        displayFilteredWords(words) {
          const levels = [100, 75, 50, 25, 0];
          levels.forEach((level) => {
            const wordsAtLevel = words.filter((word) => word.level === level);
            const box = document.getElementById(`box${level}`);
            if (box) {
              const countSpan = box.parentElement.querySelector(".word-count");
              countSpan.textContent = wordsAtLevel.length;
              box.innerHTML = wordsAtLevel
                .map(this.createWordHTML.bind(this))
                .join("");
            }
          });
        }

        exportVocabulary() {
          const data = JSON.stringify(this.vocabulary, null, 2);
          const blob = new Blob([data], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `vocabulary_${
            new Date().toISOString().split("T")[0]
          }.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }

        async importVocabulary() {
          const input = document.createElement("input");
          input.type = "file";
          input.accept = ".json";

          input.onchange = async (e) => {
            try {
              const file = e.target.files[0];
              const text = await file.text();
              const importedVocabulary = JSON.parse(text);

              if (Array.isArray(importedVocabulary)) {
                this.vocabulary = [...this.vocabulary, ...importedVocabulary];
                this.saveVocabulary();
                this.showNotification(
                  `Imported ${importedVocabulary.length} words`
                );
              }
            } catch (error) {
              console.error("Error importing vocabulary:", error);
              this.showNotification("Error importing vocabulary", "error");
            }
          };

          input.click();
        }

        openSettings() {
          document.getElementById("settingsModal").style.display = "flex";
          document.getElementById("darkModeToggle").checked =
            this.settings.darkMode;
          document.getElementById("autoPlayToggle").checked =
            this.settings.autoPlay;
        }

        closeSettings() {
          document.getElementById("settingsModal").style.display = "none";
        }

        toggleDarkMode() {
          this.settings.darkMode = !this.settings.darkMode;
          document.body.classList.toggle("dark-mode");
          this.saveSettings();
        }

        resetProgress() {
          if (
            confirm(
              "Are you sure you want to reset all progress? This cannot be undone."
            )
          ) {
            this.vocabulary = [];
            this.saveVocabulary();
            this.showNotification("Progress reset successfully");
          }
        }

        sanitizeInput(input) {
          return input.trim().replace(/[<>]/g, "").replace(/\s+/g, " ");
        }

        validateInputs(english, vietnamese) {
          if (!english || !vietnamese) {
            this.showNotification("Please fill in all fields", "error");
            return false;
          }

          if (
            this.vocabulary.some(
              (w) => w.english.toLowerCase() === english.toLowerCase()
            )
          ) {
            this.showNotification("This word already exists", "error");
            return false;
          }

          return true;
        }

        generateUniqueId() {
          return (
            Date.now().toString() + Math.random().toString(36).substr(2, 9)
          );
        }

        clearInputs(englishInput, vietnameseInput) {
          englishInput.value = "";
          vietnameseInput.value = "";
          englishInput.focus();
        }

        showNotification(message, type = "success") {
          const notification = document.getElementById("notification");
          notification.textContent = message;
          notification.style.background =
            type === "success" ? "#2ecc71" : "#e74c3c";
          notification.style.display = "block";

          setTimeout(() => {
            notification.style.display = "none";
          }, 3000);
        }

        closeFlashcards() {
          document.getElementById("flashcardModal").style.display = "none";
        }

        showStudyOptions(level) {
          this.currentLevel = level;
          document.getElementById("studyOptionsModal").style.display = "flex";
        }

        closeStudyOptions() {
          document.getElementById("studyOptionsModal").style.display = "none";
        }

        startFlashcards(mode) {
          const words = this.vocabulary.filter(
            (word) => word.level === this.currentLevel
          );
          if (words.length === 0) {
            this.showNotification("No words at this level", "error");
            return;
          }

          this.closeStudyOptions();

          // Lưu level hiện tại vào localStorage để các trang khác có thể truy cập
          localStorage.setItem("study_mode_level", this.currentLevel);

          switch (mode) {
            case "regular":
              // Giữ nguyên chế độ flashcard ở file hiện tại
              this.showFlashcards(this.currentLevel);
              break;
            case "quiz":
              // Chuyển đến trang quiz.html
              window.location.href = "quiz.html";
              break;
            case "writing":
              // Chuyển đến trang writing.html
              window.location.href = "writing.html";
              break;
            case "listening":
              // Chuyển đến trang listening.html
              window.location.href = "listening.html";
              break;
          }
        }
      }

      // Initialize the vocabulary manager
      const vocabularyManager = new VocabularyManager();
    </script>

    <!-- Study Options Modal -->
    <div class="study-options-modal" id="studyOptionsModal">
      <div class="study-options-container">
        <h2>Choose Study Mode</h2>
        <div class="study-options">
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('regular')"
          >
            <i class="fas fa-copy"></i>
            <span>Classic Flashcards</span>
            <p>Review words with front and back sides</p>
          </button>
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('quiz')"
          >
            <i class="fas fa-question-circle"></i>
            <span>Quiz Mode</span>
            <p>Test your knowledge with multiple choice questions</p>
          </button>
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('writing')"
          >
            <i class="fas fa-pencil-alt"></i>
            <span>Writing Practice</span>
            <p>Practice writing the words you've learned</p>
          </button>
          <button
            class="study-option-btn"
            onclick="vocabularyManager.startFlashcards('listening')"
          >
            <i class="fas fa-headphones"></i>
            <span>Listening Practice</span>
            <p>Improve your listening skills</p>
          </button>
        </div>
        <button
          class="close-modal-btn"
          onclick="vocabularyManager.closeStudyOptions()"
        >
          <i class="fas fa-times"></i> Close
        </button>
      </div>
    </div>
  </body>
</html>
